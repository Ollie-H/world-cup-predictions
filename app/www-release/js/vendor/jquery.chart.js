/*!
 * jquery.drawDoughnutChart.js
 * Version: 0.2(Beta)
 * Inspired by Chart.js(http://www.chartjs.org/)
 *
 * Copyright 2013 hiro
 * https://github.com/githiro/drawDoughnutChart
 * Released under the MIT license.
 * 
 */

(function(e,t){e.fn.drawDoughnutChart=function(t,n){function H(n){var r=e(this).data().order;N.text(t[r].title+": "+t[r].value).fadeIn(200),c.onPathEnter.apply(e(this),[n,t])}function B(n){N.hide(),c.onPathLeave.apply(e(this),[n,t])}function j(e){N.css({top:e.pageY+c.tipOffsetY,left:e.pageX-N.width()/2+c.tipOffsetX})}function F(e){var n=-Math.PI/2,r=1;c.animation&&c.animateRotate&&(r=e),I(e,t[0].value),T[0].setAttribute("opacity",e);for(var i=0,s=t.length;i<s;i++){var h=r*t[i].value/b*l*2,p=n+h,d=(p-n)%(l*2)>l?1:0,m=o+a(n)*g,w=u+f(n)*g,E=o+a(n)*y,S=u+f(n)*y,x=o+a(p)*g,N=u+f(p)*g,C=o+a(p)*y,k=u+f(p)*y,L=["M",m,w,"A",g,g,0,d,1,x,N,"L",C,k,"A",y,y,0,d,0,E,S,"Z"];v[i][0].setAttribute("d",L.join(" ")),n+=h}}function I(e,t){O.css({opacity:e}).text((t*e).toFixed(0))}function q(e,t){var n=c.animation?X(m(e),null,0):1;t(n)}function R(e){var t=c.animation?1/X(c.animationSteps,Number.MAX_VALUE,1):1,n=c.animation?0:1;p(function(){n+=t,q(n,e),n<=1?p(arguments.callee):c.afterDrawed.call(r)})}function U(e){return Math.max.apply(null,e)}function z(e){return Math.min.apply(null,e)}function W(e){return!isNaN(parseFloat(e))&&isFinite(e)}function X(e,t,n){return W(t)&&e>t?t:W(n)&&e<n?n:e}var r=this,i=r.width(),s=r.height(),o=i/2,u=s/2,a=Math.cos,f=Math.sin,l=Math.PI,c=e.extend({segmentShowStroke:!1,segmentStrokeColor:"#0C1013",segmentStrokeWidth:0,baseColor:"rgba(0,0,0,0.5)",baseOffset:0,edgeOffset:0,percentageInnerCutout:75,animation:!0,animationSteps:90,animationEasing:"easeInOutExpo",animateRotate:!0,tipOffsetX:-8,tipOffsetY:-45,tipClass:"doughnutTip",summaryClass:"doughnutSummary",summaryTitle:"TOTAL:",summaryTitleClass:"doughnutSummaryTitle",summaryNumberClass:"doughnutSummaryNumber",beforeDraw:function(){},afterDrawed:function(){},onPathEnter:function(e,t){},onPathLeave:function(e,t){}},n),h={linear:function(e){return e},easeInOutExpo:function(e){var t=e<.5?8*e*e*e*e:1-8*--e*e*e*e;return t>1?1:t}},p=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();c.beforeDraw.call(r);var d=e('<svg width="'+i+'" height="'+s+'" viewBox="0 0 '+i+" "+s+'" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>').appendTo(r),v=[],m=h[c.animationEasing],g=z([s/2,i/2])-c.edgeOffset,y=g*(c.percentageInnerCutout/100),b=0,w=g+c.baseOffset,E=y-c.baseOffset,S=function(){var t=document.createElementNS("http://www.w3.org/2000/svg","path"),n=e(t).appendTo(d),r=-1.57,i=6.2831,s=4.7131,l=o+a(r)*w,h=u+f(r)*w,p=o+a(r)*E,v=u+f(r)*E,m=o+a(s)*w,g=u+f(s)*w,y=o+a(s)*E,b=u+f(s)*E,S=["M",l,h,"A",w,w,0,1,1,m,g,"L",y,b,"A",E,E,0,1,0,p,v,"Z"];n[0].setAttribute("d",S.join(" ")),n[0].setAttribute("fill",c.baseColor)}(),x=document.createElementNS("http://www.w3.org/2000/svg","g"),T=e(x).appendTo(d);T[0].setAttribute("opacity",0);var N=e('<div class="'+c.tipClass+'" />').appendTo("body").hide(),C=N.width(),k=N.height(),L=(y-(g-y))*2,A=e('<div class="'+c.summaryClass+'" />').appendTo(r).css({width:L+"px",height:L+"px","margin-left":-(L/2)+"px","margin-top":-(L/2)+"px"}),O=e('<p class="'+c.summaryNumberClass+'"></p>').appendTo(A).css({opacity:0}),M=e('<p class="'+c.summaryTitleClass+'">'+c.summaryTitle+"</p>").appendTo(A);for(var _=0,D=t.length;_<D;_++){b+=t[_].value;var P=document.createElementNS("http://www.w3.org/2000/svg","path");P.setAttribute("fill",t[_].color),P.setAttribute("data-order",_),v[_]=e(P).appendTo(T)}return R(F),r}})(jQuery);